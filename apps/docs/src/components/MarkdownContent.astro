---
/**
 * 自定义 MarkdownContent 组件
 * 覆盖 starlight-blog 的 MarkdownContent 组件，添加广告支持
 *
 * 此组件基于 starlight-blog 的原始实现，添加了以下功能：
 * - 在博客文章开头显示 BlogHeaderAd 广告
 * - 在博客文章结尾显示 BlogFooterAd 广告
 * - 支持通过 frontmatter 的 hideAd 属性控制广告显示
 */
import Default from '@astrojs/starlight/components/MarkdownContent.astro'
import StarlightBlogMarkdownContent from 'starlight-blog/components/MarkdownContent.astro'

import BlogHeaderAd from './BlogHeaderAd.astro'
import BlogFooterAd from './BlogFooterAd.astro'

const { id, locale } = Astro.locals.starlightRoute

// 检查是否为博客文章页面
// 博客文章的 id 格式为 "blog/YYYY-MM-DD-xxx"
const isBlogPost = id?.startsWith('blog/') && !id.endsWith('blog/') && !id.endsWith('blog')

// 获取 hideAd 设置
// 从 starlightBlog 数据中查找当前文章，然后获取 hideAd 属性
let hideAd = false
if (isBlogPost && Astro.locals.starlightBlog) {
  const blogData = Astro.locals.starlightBlog
  // 查找匹配当前 id 的博客文章
  const currentPost = blogData.posts.find(post => post.entry.id === id)
  if (currentPost) {
    hideAd = currentPost.entry.data.hideAd ?? false
  }
}
---

{
  isBlogPost ? (
    <div class="blog-post-wrapper">
      <BlogHeaderAd hideAd={hideAd} />
      <StarlightBlogMarkdownContent>
        <slot />
      </StarlightBlogMarkdownContent>
      <BlogFooterAd hideAd={hideAd} />
    </div>
  ) : (
    <Default>
      <slot />
    </Default>
  )
}

<style>
  .blog-post-wrapper {
    /* 确保内容正常显示 */
  }
</style>
