---
/**
 * 博客文章结尾广告组件
 * 在博客文章正文之后显示扩展的链接列表区域
 */
import { GLM_PROMO_LINKS, getLink } from '@shared/links';

interface Props {
  /** 是否隐藏广告 */
  hideAd?: boolean;
}

const { hideAd = false } = Astro.props;

// 如果设置隐藏广告，则不渲染
if (hideAd) {
  return null;
}

const { glmCoding, dockerComposeGuide } = GLM_PROMO_LINKS;
---

<div class="blog-footer-ad">
  <div class="ad-header">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
    </svg>
    <span>相关链接</span>
  </div>

  <div class="ad-links">
    <!-- GLM Coding 推广链接 -->
    <div class="ad-link-item">
      <div class="link-info">
        <div class="link-title">智谱 GLM Coding: 20+ 大编程工具无缝支持（本项目同样使用智谱 AI 开发）</div>
        <div class="link-bonus">限时 {glmCoding.discount}</div>
      </div>
      <div class="link-action">
        <a
          href={glmCoding.url}
          target="_blank"
          rel="noopener noreferrer"
          class="link-button"
        >
          {glmCoding.label}
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
            <polyline points="15 3 21 3 21 9"/>
            <line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
        </a>
      </div>
    </div>

    <!-- Docker Compose 部署指南链接 -->
    <div class="ad-link-item">
      <div class="link-info">
        <div class="link-title">{dockerComposeGuide.title}</div>
        <div class="link-desc">{dockerComposeGuide.description}</div>
      </div>
      <a
        href={dockerComposeGuide.url}
        class="link-button link-button--secondary"
      >
        {dockerComposeGuide.label}
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"/>
          <path d="m12 5 7 7-7 7"/>
        </svg>
      </a>
    </div>
  </div>
</div>

<style>
  .blog-footer-ad {
    padding: 1.25rem;
    margin-block-start: 1.5rem;
    border-radius: var(--sl-radius-md);
    background: var(--sl-color-gray-6);
    border: 1px solid var(--sl-color-gray-5);
  }

  .ad-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: var(--sl-color-text-high);
    margin-block-end: 1rem;
    padding-block-end: 0.75rem;
    border-block-end: 1px solid var(--sl-color-gray-5);
  }

  .ad-header svg {
    color: var(--color-primary);
  }

  .ad-links {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .ad-link-item {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.75rem;
    border-radius: var(--sl-radius-sm);
    background: var(--sl-color-bg);
    border: 1px solid var(--sl-color-gray-5);
    transition: border-color 0.2s ease;
  }

  .ad-link-item:hover {
    border-color: color-mix(in srgb, var(--color-primary) 30%, var(--sl-color-gray-5));
  }

  .link-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
  }

  .link-action {
    flex-shrink: 0;
  }

  .link-title {
    font-weight: 500;
    color: var(--sl-color-text-high);
    font-size: 0.9375rem;
    margin-block-end: 0.125rem;
  }

  .link-bonus {
    font-size: 0.8125rem;
    color: var(--color-success);
    font-weight: 500;
  }

  .link-desc {
    font-size: 0.8125rem;
    color: var(--sl-color-text);
  }

  .link-button {
    flex-shrink: 0;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.375rem 0.75rem;
    border-radius: var(--sl-radius-sm);
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: white;
    text-decoration: none;
    font-size: 0.8125rem;
    font-weight: 500;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .link-button--secondary {
    background: var(--sl-color-gray-4);
    color: var(--sl-color-text-high);
  }

  .link-button:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 128, 255, 0.2);
  }

  .link-button--secondary:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  /* 响应式优化 */
  @media (max-width: 640px) {
    .ad-link-item {
      flex-direction: column;
    }

    .link-button {
      align-self: flex-start;
    }
  }

  /* 减少动画偏好 */
  @media (prefers-reduced-motion: reduce) {
    .ad-link-item,
    .link-button {
      transition: none !important;
    }

    .link-button:hover {
      transform: none;
    }
  }
</style>
