---
import { fetchDesktopVersions, groupAssetsByPlatform } from "@/utils/desktop";
import type { DesktopVersion, PlatformGroup } from "@/types/desktop";
import { Tabs, TabItem } from "@astrojs/starlight/components";
import Clarity from "@/components/Clarity.astro";
// å¯¼å…¥é¦–é¡µæ ·å¼ç³»ç»Ÿ
import '@/styles/homepage.css';
// å¯¼å…¥ Desktop é¡µé¢ä¸“å±æ ·å¼
import '@/styles/desktop.css';
// å¯¼å…¥é¦–é¡µç»„ä»¶
import Navbar from '@/components/home/Navbar';
import Footer from '@/components/home/Footer';
// å¯¼å…¥å›¾æ ‡ç»„ä»¶
import FeatureIcon from '@/components/desktop/FeatureIcon.astro';
import FeatureTagIcon from '@/components/desktop/FeatureTagIcon.astro';
import PlatformIcon from '@/components/desktop/PlatformIcon.astro';
import DownloadOption from '@/components/desktop/DownloadOption.astro';

// åœ¨æ„å»ºæ—¶è·å–ç‰ˆæœ¬æ•°æ®
let versionData: {
  latest: DesktopVersion | null;
  allVersions: DesktopVersion[];
  latestPlatforms: PlatformGroup[];
  error: string | null;
  channels: {
    stable: { latest: DesktopVersion | null; all: DesktopVersion[] };
    beta: { latest: DesktopVersion | null; all: DesktopVersion[] };
  };
} = {
  latest: null,
  allVersions: [],
  latestPlatforms: [],
  error: null,
  channels: {
    stable: { latest: null, all: [] },
    beta: { latest: null, all: [] }
  }
};

try {
  const data = await fetchDesktopVersions();
  versionData.allVersions = data.versions;

  // ä¼˜å…ˆä½¿ç”¨ channels.stable.latest ä½œä¸ºé»˜è®¤æ˜¾ç¤ºçš„ç‰ˆæœ¬
  if (data.channels && data.channels.stable && data.channels.stable.latest) {
    const stableLatestVersion = data.channels.stable.latest;
    versionData.latest = data.versions.find(v => v.version === stableLatestVersion) || data.versions[0] || null;
  } else {
    versionData.latest = data.versions[0] || null;
  }

  if (versionData.latest) {
    versionData.latestPlatforms = groupAssetsByPlatform(
      versionData.latest.files
    );
  }

  // å¤„ç†æ¸ é“æ•°æ®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
  if (data.channels) {
    // ä» channels æ•°æ®ä¸­æå–ç‰ˆæœ¬ä¿¡æ¯
    const stableVersions = data.channels.stable?.versions || [];
    const betaVersions = data.channels.beta?.versions || [];
    const stableLatest = data.channels.stable?.latest;
    const betaLatest = data.channels.beta?.latest;

    // æŸ¥æ‰¾å¯¹åº”çš„ç‰ˆæœ¬å¯¹è±¡
    if (stableLatest) {
      versionData.channels.stable.latest = data.versions.find(v => v.version === stableLatest) || null;
    }
    if (betaLatest) {
      versionData.channels.beta.latest = data.versions.find(v => v.version === betaLatest) || null;
    }

    // è·å–æ¸ é“çš„æ‰€æœ‰ç‰ˆæœ¬
    versionData.channels.stable.all = data.versions.filter(v => stableVersions.includes(v.version));
    versionData.channels.beta.all = data.versions.filter(v => betaVersions.includes(v.version));
  }
} catch (e) {
  versionData.error = e instanceof Error ? e.message : String(e);
  console.error("Failed to fetch desktop versions:", e);
}

const { latest, allVersions, latestPlatforms, error, channels } = versionData;

// åˆ¤æ–­æ˜¯å¦æœ‰æ¸ é“æ•°æ®å¯ç”¨
const hasChannels = channels.stable.latest !== null || channels.beta.latest !== null;

// ä¸ºæ¯ä¸ªå¹³å°åˆ›å»ºä¸‹è½½é€‰é¡¹æ˜ å°„
const platformOptions = latestPlatforms.map(platform => {
  // å°† downloads è½¬æ¢ä¸º DownloadOption æ ¼å¼
  const options = platform.downloads.map(download => ({
    label: download.filename,
    url: download.url,
    size: download.size
  }));

  // ç¡®å®šæ¨èçš„é»˜è®¤é€‰é¡¹
  let defaultIndex = 0;
  if (platform.platform === 'windows') {
    defaultIndex = platform.downloads.findIndex(d => d.filename.includes('Setup')) ?? 0;
  } else if (platform.platform === 'macos') {
    defaultIndex = platform.downloads.findIndex(d => d.filename.includes('arm64')) ?? 0;
  } else if (platform.platform === 'linux') {
    defaultIndex = platform.downloads.findIndex(d => d.filename.includes('AppImage')) ?? 0;
  }

  return {
    platform: platform.platform as 'windows' | 'macos' | 'linux',
    platformLabel: platform.platform === 'windows' ? 'Windows' :
                    platform.platform === 'macos' ? 'macOS' : 'Linux',
    options,
    defaultOption: defaultIndex,
    isRecommended: false
  };
});

// æ£€æµ‹ç”¨æˆ·æ“ä½œç³»ç»Ÿå¹¶é‡æ–°æ’åºå¹³å°ï¼ˆå®¢æˆ·ç«¯è„šæœ¬ï¼‰
// ä¸å†ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²å˜é‡ï¼Œç›´æ¥åœ¨ HTML ä¸­ä½¿ç”¨ <script> æ ‡ç­¾

// SEO å…ƒæ•°æ®
const title = "Hagicode Desktop - ä¸‹è½½";
const description = "ä¸‹è½½ Hagicode Desktopï¼Œæœ¬åœ°åŒ–çš„ AI ä»£ç åŠ©æ‰‹ã€‚æ”¯æŒ Windowsã€macOS å’Œ Linuxï¼Œä¿æŠ¤éšç§ï¼Œå¿«é€Ÿå“åº”ã€‚";

// è·å–ç«™ç‚¹åŸºç¡€è·¯å¾„
const siteBase = import.meta.env.VITE_SITE_BASE || "/";

// å‡†å¤‡æ¸ é“æ•°æ®ç”¨äºå®¢æˆ·ç«¯è„šæœ¬ï¼ˆåºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼‰
const channelDataForClient = {
  stable: {
    latest: channels.stable.latest?.version || '',
    platforms: channels.stable.latest ? channels.stable.latest.files.map(f => ({
      name: f.name,
      path: f.path,
      size: f.size
    })) : []
  },
  beta: {
    latest: channels.beta.latest?.version || '',
    platforms: channels.beta.latest ? channels.beta.latest.files.map(f => ({
      name: f.name,
      path: f.path,
      size: f.size
    })) : []
  }
};

const channelDataJSON = JSON.stringify(channelDataForClient);
---

<!doctype html>
<html lang="zh-CN" data-site-base={siteBase}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} />
    <!-- ç™¾åº¦æœç´¢å¼•æ“éªŒè¯ -->
    <meta name="baidu-site-verification" content="codeva-A9s3yT3z5m" />
    <meta name="og:title" content={title} />
    <meta name="og:description" content={description} />
    <meta name="og:type" content="website" />
    <script is:inline>
      // åˆå§‹åŒ–ä¸»é¢˜ - ä¸ä¸»é¡µä¿æŒä¸€è‡´
      (function() {
        // åˆ¤æ–­æ˜¯å¦åœ¨å†œå†æ–°å¹´æœŸé—´
        // è›‡å¹´2025: 2025-01-29 è‡³ 2025-02-12 (å…ƒå®µèŠ‚)
        // é©¬å¹´2026: 2026-02-17 è‡³ 2026-03-03 (å…ƒå®µèŠ‚)
        function isLunarNewYearPeriod() {
          const now = new Date();
          const year = now.getFullYear();
          const month = now.getMonth() + 1; // 1-12
          const day = now.getDate();

          // 2025å¹´è›‡å¹´æ–°å¹´æœŸé—´ (1æœˆ29æ—¥ - 2æœˆ12æ—¥)
          if (year === 2025) {
            if (month === 1 && day >= 29) return true;
            if (month === 2 && day <= 12) return true;
          }
          // 2026å¹´é©¬å¹´æ–°å¹´æœŸé—´ (2æœˆ17æ—¥ - 3æœˆ3æ—¥)
          if (year === 2026) {
            if (month === 2 && day >= 17) return true;
            if (month === 3 && day <= 3) return true;
          }
          return false;
        }

        const stored = localStorage.getItem('starlight-theme');
        const system = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        let theme;

        if (stored) {
          // ç”¨æˆ·å·²æœ‰ä¸»é¢˜åå¥½,ä½¿ç”¨å…¶é€‰æ‹©
          theme = stored;
        } else {
          // ç”¨æˆ·æ— ä¸»é¢˜åå¥½,åº”ç”¨æ™ºèƒ½é»˜è®¤
          theme = isLunarNewYearPeriod() ? 'lunar-new-year' : system;
        }

        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
  </head>
  <body class="homepage">
    <Navbar
      desktopVersion={latest}
      desktopPlatforms={latestPlatforms}
      desktopVersionError={error}
      client:load
    />

    <main class="homepage">
      <!-- Hero Section -->
      <section class="hero">
        <!-- ç§‘æŠ€æ„Ÿè£…é¥°å…ƒç´  - å…¨å®½èƒŒæ™¯ -->
        <div class="tech-grid-bg" />
        <div class="bgGlow" />
        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="hero-content">
          <div class="hero-badge">æ¡Œé¢ç‰ˆ</div>
          <h1>Hagicode Desktop</h1>
          <p class="hero-tagline">æœ¬åœ°åŒ–çš„ AI ä»£ç åŠ©æ‰‹ï¼Œä¿æŠ¤éšç§ï¼Œæå‡æ•ˆç‡</p>

          <div class="hero-value-prop">
            <div class="value-point">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="12" r="10"/>
              </svg>
              <span>100% æœ¬åœ°è¿è¡Œï¼Œä»£ç ä¸ä¸Šä¼ </span>
            </div>
            <div class="value-point">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 10V3L4 14h7v7l9-11h-7z" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>æ¯«ç§’çº§å“åº”ï¼Œæ— éœ€ç­‰å¾…</span>
            </div>
            <div class="value-point">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 15V3m0 12l-4-4m4 4l4-4M2 17l.621 2.485A2 2 0 004.561 21h14.878a2 2 0 001.94-1.515L22 17" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>ä¸€é”®å®‰è£…ï¼Œå¼€ç®±å³ç”¨</span>
            </div>
          </div>

          {hasChannels && (
            <div class="channel-selector" id="channel-selector">
              <button
                class="channel-tab channel-tab--active"
                data-channel="stable"
                aria-selected="true"
              >
                <span class="channel-icon">ğŸŸ¢</span>
                <span class="channel-label">ç¨³å®šç‰ˆ</span>
              </button>
              <button
                class="channel-tab"
                data-channel="beta"
                aria-selected="false"
              >
                <span class="channel-icon">ğŸ§ª</span>
                <span class="channel-label">æµ‹è¯•ç‰ˆ Beta</span>
              </button>
            </div>
          )}

          {hasChannels && (
            <div class="beta-warning" id="beta-warning" style="display: none;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="warning-icon">
                <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <div class="warning-content">
                <strong>æµ‹è¯•ç‰ˆè­¦å‘Š</strong>
                <p>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç‰ˆæœ¬ï¼Œå¯èƒ½å­˜åœ¨ä¸ç¨³å®šé—®é¢˜ã€‚å»ºè®®ç”¨äºæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ç¨³å®šç‰ˆã€‚</p>
              </div>
            </div>
          )}

          {error ? (
            <div class="error-message">
              <p>âš ï¸ æ— æ³•åŠ è½½ç‰ˆæœ¬ä¿¡æ¯</p>
              <p>{error}</p>
              <a
                href="https://desktop.dl.hagicode.com/"
                class="btn btn-primary"
                target="_blank"
                rel="noopener noreferrer"
              >
                å‰å¾€ä¸‹è½½é¡µé¢
              </a>
            </div>
          ) : latest ? (
            <>
              <div class="download-buttons">
                {platformOptions.map((option) => (
                  <DownloadOption
                    platform={option.platform}
                    platformLabel={option.platformLabel}
                    defaultOption={option.defaultOption}
                    options={option.options}
                    isRecommended={option.isRecommended}
                  />
                ))}
              </div>
              <p class="version-info">
                æœ€æ–°ç‰ˆæœ¬: {latest.version}
                {latestPlatforms.length > 0 && (
                  <span class="platform-info">
                    {" "}
                    â€¢ æ”¯æŒ{" "}
                    {latestPlatforms.map((p) =>
                      p.platform === 'windows' ? 'Windows' :
                      p.platform === 'macos' ? 'macOS' : 'Linux'
                    ).join("ã€")}
                  </span>
                )}
              </p>
            </>
          ) : (
            <p>æš‚æ— å¯ç”¨çš„ä¸‹è½½ç‰ˆæœ¬</p>
          )}

          <div class="hero-features">
            <span class="feature-tag">
              <FeatureTagIcon name="lock" />
              éšç§ä¿æŠ¤
            </span>
            <span class="feature-tag">
              <FeatureTagIcon name="bolt" />
              å¿«é€Ÿå“åº”
            </span>
            <span class="feature-tag">
              <FeatureTagIcon name="computer" />
              è·¨å¹³å°æ”¯æŒ
            </span>
          </div>
        </div>
      </section>

      <!-- åŠŸèƒ½ç‰¹æ€§åŒºåŸŸ -->
      <section class="features">
        <h2>æ ¸å¿ƒåŠŸèƒ½</h2>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon-wrapper">
              <FeatureIcon name="rocket" size={48} />
            </div>
            <h3>æœ¬åœ°è¿è¡Œ</h3>
            <p>æ‰€æœ‰æ•°æ®æœ¬åœ°å¤„ç†ï¼Œæ— éœ€ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œç¡®ä¿ä»£ç éšç§å®‰å…¨</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon-wrapper">
              <FeatureIcon name="lock" size={48} />
            </div>
            <h3>éšç§ä¿æŠ¤</h3>
            <p>ä»£ç å®Œå…¨ä¸ä¸Šä¼ ï¼Œæ”¯æŒç¦»çº¿ä½¿ç”¨ï¼Œä¿æŠ¤ä½ çš„çŸ¥è¯†äº§æƒ</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon-wrapper">
              <FeatureIcon name="bolt" size={48} />
            </div>
            <h3>å¿«é€Ÿå“åº”</h3>
            <p>æ¯«ç§’çº§å“åº”æ—¶é—´ï¼Œæ— éœ€ç­‰å¾…ç½‘ç»œè¯·æ±‚ï¼Œæå‡å¼€å‘æ•ˆç‡</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon-wrapper">
              <FeatureIcon name="computer" size={48} />
            </div>
            <h3>è·¨å¹³å°æ”¯æŒ</h3>
            <p>æ”¯æŒ Windowsã€macOS å’Œ Linuxï¼Œæ»¡è¶³ä¸åŒå¼€å‘ç¯å¢ƒéœ€æ±‚</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon-wrapper">
              <FeatureIcon name="arrow-path" size={48} />
            </div>
            <h3>è‡ªåŠ¨æ›´æ–°</h3>
            <p>è‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼Œä¸€é”®å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè·å–æœ€æ–°åŠŸèƒ½</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon-wrapper">
              <FeatureIcon name="globe" size={48} />
            </div>
            <h3>å¤šè¯­è¨€æ”¯æŒ</h3>
            <p>å†…ç½®ä¸­è‹±æ–‡ç•Œé¢ï¼Œæ”¯æŒå›½é™…åŒ–å¼€å‘å›¢é˜Ÿåä½œ</p>
          </div>
        </div>
      </section>

      <!-- ç³»ç»Ÿè¦æ±‚ -->
      <section class="system-requirements">
        <h2>ç³»ç»Ÿè¦æ±‚</h2>
        <Tabs>
          <TabItem label="Windows">
            <div class="requirements-content">
              <p>
                <strong>æ“ä½œç³»ç»Ÿ:</strong> Windows 10/11 (64-bit)
              </p>
              <p>
                <strong>å¤„ç†å™¨:</strong> Intel Core i3 æˆ–åŒç­‰æ€§èƒ½å¤„ç†å™¨
              </p>
              <p>
                <strong>å†…å­˜:</strong> 4GB RAM (æ¨è 8GB)
              </p>
              <p>
                <strong>ç£ç›˜ç©ºé—´:</strong> 2GB å¯ç”¨ç©ºé—´
              </p>
              <p>
                <strong>ç½‘ç»œ:</strong> åˆå§‹ä¸‹è½½éœ€è¦ç½‘ç»œè¿æ¥ï¼ˆåç»­å¯ç¦»çº¿ä½¿ç”¨ï¼‰
              </p>
            </div>
          </TabItem>
          <TabItem label="macOS">
            <div class="requirements-content">
              <p>
                <strong>æ“ä½œç³»ç»Ÿ:</strong> macOS 12+ (Monterey æˆ–æ›´é«˜ç‰ˆæœ¬)
              </p>
              <p>
                <strong>å¤„ç†å™¨:</strong> Apple Silicon (M1/M2/M3) æˆ– Intel
                Core i3+
              </p>
              <p>
                <strong>å†…å­˜:</strong> 4GB RAM (æ¨è 8GB)
              </p>
              <p>
                <strong>ç£ç›˜ç©ºé—´:</strong> 2GB å¯ç”¨ç©ºé—´
              </p>
              <p>
                <strong>ç½‘ç»œ:</strong> åˆå§‹ä¸‹è½½éœ€è¦ç½‘ç»œè¿æ¥ï¼ˆåç»­å¯ç¦»çº¿ä½¿ç”¨ï¼‰
              </p>
            </div>
          </TabItem>
          <TabItem label="Linux">
            <div class="requirements-content">
              <p>
                <strong>æ“ä½œç³»ç»Ÿ:</strong> Ubuntu 20.04+ / Debian 11+ / å…¶ä»–ä¸»æµå‘è¡Œç‰ˆ
              </p>
              <p>
                <strong>å¤„ç†å™¨:</strong> Intel Core i3 æˆ–åŒç­‰æ€§èƒ½å¤„ç†å™¨
              </p>
              <p>
                <strong>å†…å­˜:</strong> 4GB RAM (æ¨è 8GB)
              </p>
              <p>
                <strong>ç£ç›˜ç©ºé—´:</strong> 2GB å¯ç”¨ç©ºé—´
              </p>
              <p>
                <strong>ç½‘ç»œ:</strong> åˆå§‹ä¸‹è½½éœ€è¦ç½‘ç»œè¿æ¥ï¼ˆåç»­å¯ç¦»çº¿ä½¿ç”¨ï¼‰
              </p>
              <p>
                <strong>æ³¨æ„:</strong> éœ€è¦å®‰è£…å›¾å½¢ç•Œé¢ç¯å¢ƒ
              </p>
            </div>
          </TabItem>
        </Tabs>
      </section>

      <!-- å®‰è£…æŒ‡å— -->
      <section class="installation-guide">
        <h2>å®‰è£…æŒ‡å—</h2>
        <Tabs>
          <TabItem label="Windows">
            <div class="guide-content">
              <ol>
                <li>
                  <strong>ä¸‹è½½å®‰è£…åŒ…</strong>
                  <br />
                  ç‚¹å‡»ä¸Šæ–¹çš„ "Windows ä¸‹è½½" æŒ‰é’®ï¼Œä¸‹è½½
                  <code>Hagicode-Desktop-Setup-x.x.x.exe</code> æ–‡ä»¶
                </li>
                <li>
                  <strong>è¿è¡Œå®‰è£…ç¨‹åº</strong>
                  <br />
                  åŒå‡»ä¸‹è½½çš„ <code>.exe</code> æ–‡ä»¶ï¼Œåœ¨ Windows SmartScreen
                  æç¤ºæ—¶ç‚¹å‡»"æ›´å¤šä¿¡æ¯"ç„¶å"è¿è¡Œ"
                </li>
                <li>
                  <strong>å®Œæˆå®‰è£…</strong>
                  <br />
                  æŒ‰ç…§å®‰è£…å‘å¯¼å®Œæˆå®‰è£…ï¼Œå®‰è£…å®Œæˆåå¯ä»¥ä»å¼€å§‹èœå•å¯åŠ¨ Hagicode
                  Desktop
                </li>
              </ol>
              :::tip[å®‰è£…å¤±è´¥]
              å¦‚æœå®‰è£…å¤±è´¥ï¼Œè¯·ç¡®ä¿ï¼š
              - å·²å…³é—­æ­£åœ¨è¿è¡Œçš„ Hagicode Desktop å®ä¾‹
              - æœ‰ç®¡ç†å‘˜æƒé™
              - ç³»ç»Ÿæ»¡è¶³æœ€ä½è¦æ±‚
              :::
            </div>
          </TabItem>
          <TabItem label="macOS">
            <div class="guide-content">
              <h3>Intel Mac</h3>
              <ol>
                <li>
                  <strong>ä¸‹è½½ DMG æ–‡ä»¶</strong>
                  <br />
                  ä¸‹è½½ <code>Hagicode-Desktop-*.dmg</code> æ–‡ä»¶
                </li>
                <li>
                  <strong>æ‰“å¼€ DMG æ–‡ä»¶</strong>
                  <br />
                  åŒå‡»æ‰“å¼€ DMG æ–‡ä»¶
                </li>
                <li>
                  <strong>å®‰è£…åº”ç”¨</strong>
                  <br />
                  å°† Hagicode Desktop æ‹–å…¥åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹
                </li>
                <li>
                  <strong>ç§»é™¤éš”ç¦»å±æ€§</strong>
                  <br />
                  æ‰“å¼€"ç»ˆç«¯"åº”ç”¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
                  <br />
                  <code>sudo xattr -dr com.apple.quarantine /Applications/Hagicode\ Desktop.app</code>
                  <br />
                  <br />
                  è¯¥å‘½ä»¤ä¼šç§»é™¤ macOS Gatekeeper å¯¹ä»äº’è”ç½‘ä¸‹è½½çš„åº”ç”¨è‡ªåŠ¨æ·»åŠ çš„éš”ç¦»å±æ€§ï¼Œä»è€Œé¿å…å¯åŠ¨æ—¶çš„å®‰å…¨æç¤ºã€‚
                </li>
                <li>
                  <strong>å¯åŠ¨åº”ç”¨</strong>
                  <br />
                  ä»å¯åŠ¨å°å¯åŠ¨ Hagicode Desktop
                </li>
              </ol>

              <h3>Apple Silicon Mac (M1/M2/M3)</h3>
              <ol>
                <li>
                  <strong>ä¸‹è½½ DMG æ–‡ä»¶</strong>
                  <br />
                  ä¸‹è½½ <code>Hagicode-Desktop-*-arm64.dmg</code> æ–‡ä»¶
                </li>
                <li>
                  <strong>æ‰“å¼€ DMG æ–‡ä»¶</strong>
                  <br />
                  åŒå‡»æ‰“å¼€ DMG æ–‡ä»¶
                </li>
                <li>
                  <strong>å®‰è£…åº”ç”¨</strong>
                  <br />
                  å°† Hagicode Desktop æ‹–å…¥åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹
                </li>
                <li>
                  <strong>ç§»é™¤éš”ç¦»å±æ€§</strong>
                  <br />
                  æ‰“å¼€"ç»ˆç«¯"åº”ç”¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
                  <br />
                  <code>sudo xattr -dr com.apple.quarantine /Applications/Hagicode\ Desktop.app</code>
                  <br />
                  <br />
                  è¯¥å‘½ä»¤ä¼šç§»é™¤ macOS Gatekeeper å¯¹ä»äº’è”ç½‘ä¸‹è½½çš„åº”ç”¨è‡ªåŠ¨æ·»åŠ çš„éš”ç¦»å±æ€§ï¼Œä»è€Œé¿å…å¯åŠ¨æ—¶çš„å®‰å…¨æç¤ºã€‚
                </li>
                <li>
                  <strong>å¯åŠ¨åº”ç”¨</strong>
                  <br />
                  ä»å¯åŠ¨å°å¯åŠ¨ Hagicode Desktop
                </li>
              </ol>

              :::tip[æç¤º]
              å¦‚æœæœªæ‰§è¡Œä¸Šè¿°å‘½ä»¤ç§»é™¤éš”ç¦»å±æ€§ï¼Œé¦–æ¬¡å¯åŠ¨æ—¶ç³»ç»Ÿå¯èƒ½ä¼šæç¤º"æ— æ³•éªŒè¯å¼€å‘è€…"ã€‚æ­¤æ—¶è¯·åœ¨ç³»ç»Ÿåå¥½è®¾ç½® > å®‰å…¨æ€§ä¸éšç§ä¸­ç‚¹å‡»"ä»è¦æ‰“å¼€"ã€‚æˆ–è€…æ‚¨ä¹Ÿå¯ä»¥å…ˆå…³é—­è¯¥æç¤ºï¼Œç„¶ååœ¨ç»ˆç«¯æ‰§è¡Œä¸Šè¿° xattr å‘½ä»¤åå†é‡æ–°å¯åŠ¨åº”ç”¨ã€‚
              :::
            </div>
          </TabItem>
          <TabItem label="Linux">
            <div class="guide-content">
              <h3>ä½¿ç”¨ AppImageï¼ˆæ¨èï¼‰</h3>
              <ol>
                <li>
                  <strong>ä¸‹è½½ AppImage</strong>
                  <br />
                  ç‚¹å‡»ä¸Šæ–¹çš„ "Linux ä¸‹è½½" æŒ‰é’®ï¼Œä¸‹è½½ <code>.AppImage</code>
                  æ–‡ä»¶
                </li>
                <li>
                  <strong>æ·»åŠ æ‰§è¡Œæƒé™</strong>
                  <br />
                  <code>chmod +x Hagicode.Desktop-*.AppImage</code>
                </li>
                <li>
                  <strong>è¿è¡Œåº”ç”¨</strong>
                  <br />
                  <code>./Hagicode.Desktop-*.AppImage</code>
                </li>
              </ol>

              <h3>ä½¿ç”¨ Debian åŒ…</h3>
              <ol>
                <li>
                  <strong>ä¸‹è½½ Debian åŒ…</strong>
                  <br />
                  ä¸‹è½½ <code>_amd64.deb</code> æ–‡ä»¶
                </li>
                <li>
                  <strong>å®‰è£…åŒ…</strong>
                  <br />
                  <code>sudo dpkg -i hagicode-desktop_*_amd64.deb</code>
                </li>
                <li>
                  <strong>ä¿®å¤ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰</strong>
                  <br />
                  <code>sudo apt-get install -f</code>
                </li>
              </ol>
            </div>
          </TabItem>
        </Tabs>
      </section>

      <!-- ç‰ˆæœ¬å†å² -->
      <section class="version-history">
        <h2>ç‰ˆæœ¬å†å²</h2>
        <div class="version-list">
          {allVersions.map((version) => (
            <div class="version-item">
              <div class="version-header">
                <h3>{version.version}</h3>
                {version === latest && (
                  <span class="latest-badge">æœ€æ–°ç‰ˆæœ¬</span>
                )}
              </div>
              <details>
                <summary>æŸ¥çœ‹ä¸‹è½½é€‰é¡¹</summary>
                <div class="version-downloads">
                  <table>
                    <thead>
                      <tr>
                        <th>å¹³å°</th>
                        <th>ç±»å‹</th>
                        <th>æ–‡ä»¶å¤§å°</th>
                        <th>ä¸‹è½½</th>
                      </tr>
                    </thead>
                    <tbody>
                      {groupAssetsByPlatform(version.files).map((platform) =>
                        platform.downloads.map((download) => (
                          <tr>
                            <td>{platform.platform}</td>
                            <td>{download.filename}</td>
                            <td>{download.size}</td>
                            <td>
                              <a
                                href={download.url}
                                class="btn-link"
                                target="_blank"
                                rel="noopener noreferrer"
                              >
                                ä¸‹è½½
                              </a>
                            </td>
                          </tr>
                        ))
                      )}
                    </tbody>
                  </table>
                </div>
              </details>
            </div>
          ))}
        </div>
      </section>

      <!-- FAQ -->

      <!-- æ¸ é“æ•°æ®å­˜å‚¨ï¼ˆä½œä¸º data å±æ€§ï¼‰ -->
      <div
        id="channel-data"
        style="display:none"
        data-has-channels={hasChannels}
        data-channels={channelDataJSON}
      ></div>
      <section class="faq">
        <h2>å¸¸è§é—®é¢˜</h2>
        <div class="faq-list">
          <details class="faq-item">
            <summary>
              Desktop ç‰ˆæœ¬å’Œ Server ç‰ˆæœ¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
            </summary>
            <div class="faq-content">
              <p>
                Hagicode æä¾›ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼šDesktop ç‰ˆæœ¬å’Œ Server ç‰ˆæœ¬ã€‚ä¸¤ç§ç‰ˆæœ¬å„æœ‰ä¼˜åŠ¿ï¼Œä½†éƒ½é‡‡ç”¨ç”¨æˆ·è‡ªä¸»ç®¡ç†æœåŠ¡å™¨å’Œæ•°æ®çš„æ–¹å¼ï¼Œå› æ­¤éƒ½å…·å¤‡æ›´å¥½çš„æ•°æ®ä¿æŠ¤ç‰¹æ€§ã€‚
              </p>
              <h4>Desktop ç‰ˆæœ¬</h4>
              <ul>
                <li>åœ¨æœ¬åœ°ç”µè„‘ä¸Šè¿è¡Œï¼Œæ›´åŠ è½»ä¾¿</li>
                <li>æ— éœ€é…ç½®æœåŠ¡å™¨ï¼Œå¼€ç®±å³ç”¨</li>
                <li>é€‚åˆä¸ªäººå¼€å‘è€…å’Œè½»é‡ä½¿ç”¨åœºæ™¯</li>
                <li>æ‰€æœ‰æ•°æ®å®Œå…¨æœ¬åœ°åŒ–</li>
              </ul>
              <h4>Server ç‰ˆæœ¬</h4>
              <ul>
                <li>å¯éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Š</li>
                <li>æ”¯æŒå¤šç”¨æˆ·è¿œç¨‹è®¿é—®</li>
                <li>æ›´é€‚åˆå›¢é˜Ÿåä½œå’Œå¹¿æ³›æ‰©å±•</li>
                <li>ä¸ºæœªæ¥çš„ä¼ä¸šçº§åŠŸèƒ½å’Œå¤šè®¾å¤‡åŒæ­¥åšå‡†å¤‡</li>
              </ul>
              <p>
                æ— è®ºé€‰æ‹©å“ªç§ç‰ˆæœ¬ï¼Œä½ éƒ½å®Œå…¨æŒæ§è‡ªå·±çš„æœåŠ¡å™¨å’Œæ•°æ®ï¼Œäº«å—æ›´å¥½çš„éšç§ä¿æŠ¤å’Œæ•°æ®å®‰å…¨ã€‚
              </p>
            </div>
          </details>

          <details class="faq-item">
            <summary>å®‰è£…åè¿˜éœ€è¦åšä»€ä¹ˆï¼Ÿ</summary>
            <div class="faq-content">
              <p>
                Hagicode Desktop æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯åŠ¨å™¨ï¼Œå®‰è£…å®Œæˆåé¦–æ¬¡å¯åŠ¨æ—¶ï¼Œå®ƒä¼šå¼•å¯¼ä½ å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š
              </p>
              <ul>
                <li><strong>ä¸‹è½½ Hagicode Coreï¼š</strong> Desktop ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æç¤ºä¸‹è½½ Hagicode æ ¸å¿ƒç»„ä»¶</li>
                <li><strong>å®‰è£…æ ¸å¿ƒç»„ä»¶ï¼š</strong> æŒ‰ç…§ç•Œé¢æç¤ºå®Œæˆæ ¸å¿ƒç»„ä»¶çš„å®‰è£…</li>
                <li><strong>é…ç½® AI ç¼–ç åŠ©æ‰‹ï¼š</strong> æ ¹æ®éœ€è¦é…ç½® Claude Code ç­‰åŠ©æ‰‹</li>
              </ul>
              <p>
                æ•´ä¸ªè¿‡ç¨‹åœ¨ Desktop ç•Œé¢ä¸­éƒ½æœ‰æ¸…æ™°çš„æç¤ºæŒ‡å¼•ï¼Œè¯·ç¡®ä¿åœ¨é¦–æ¬¡å¯åŠ¨æ—¶ä¿æŒç½‘ç»œè¿æ¥ä»¥å®Œæˆæ ¸å¿ƒç»„ä»¶çš„ä¸‹è½½ã€‚
              </p>
              <p>
                å®Œæˆè¿™äº›æ­¥éª¤åï¼Œä½ å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ Hagicode Desktop çš„æ‰€æœ‰åŠŸèƒ½äº†ã€‚
              </p>
            </div>
          </details>

          <details class="faq-item">
            <summary>å¦‚ä½•æ£€æŸ¥æ›´æ–°ï¼Ÿ</summary>
            <div class="faq-content">
              <p>
                Desktop ä¼šè‡ªåŠ¨æ£€æŸ¥æ›´æ–°ã€‚å½“æœ‰æ–°ç‰ˆæœ¬å¯ç”¨æ—¶ï¼Œä¼šåœ¨ç•Œé¢å³ä¸Šè§’æ˜¾ç¤ºæç¤ºã€‚ä½ ä¹Ÿå¯ä»¥åœ¨"è®¾ç½®"ä¸­æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°ã€‚
              </p>
            </div>
          </details>

          <details class="faq-item">
            <summary>æ”¯æŒå“ªäº› AI æ¨¡å‹ï¼Ÿ</summary>
            <div class="faq-content">
              <p>Hagicode Desktop é€šè¿‡ Agent CLI æä¾›å¼ºå¤§çš„ AI ç¼–ç åŠ©æ‰‹æ”¯æŒï¼š</p>
              <ul>
                <li><strong>å½“å‰æ”¯æŒï¼š</strong>Claude Codeï¼ˆä¸»è¦æ”¯æŒï¼‰</li>
                <li><strong>å³å°†æ”¯æŒï¼š</strong>Copilotã€Geminiã€Kimi Code ç­‰å„ç±» CLI Agent</li>
              </ul>
              <p>æˆ‘ä»¬æ­£åœ¨ç§¯ææ‰©å±•å¯¹æ›´å¤š AI ç¼–ç åŠ©æ‰‹çš„æ”¯æŒï¼Œæ•¬è¯·æœŸå¾…åç»­ç‰ˆæœ¬çš„æ›´æ–°ã€‚</p>
            </div>
          </details>

          <details class="faq-item">
            <summary>æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ</summary>
            <div class="faq-content">
              <p>Hagicode Desktop ä½¿ç”¨ Electron æ¡†æ¶å‘å¸ƒï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨ Electron çš„ UserData ç›®å½•ä¸­ï¼š</p>
              <ul>
                <li>
                  <strong>Windows:</strong> <code>C:\Users\&lt;ç”¨æˆ·å&gt;\AppData\Roaming\Hagicode Desktop</code>
                </li>
                <li>
                  <strong>macOS:</strong> <code>~/Library/Application Support/Hagicode Desktop</code>
                </li>
                <li>
                  <strong>Linux:</strong> <code>~/.config/Hagicode Desktop</code>
                </li>
              </ul>
              <p>è¿™æ˜¯ Electron åº”ç”¨çš„æ ‡å‡†æ•°æ®å­˜å‚¨ä½ç½®ï¼Œç¡®ä¿ä½ çš„é…ç½®å’Œæ•°æ®ä¸åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚</p>
            </div>
          </details>

          <details class="faq-item">
            <summary>å¦‚ä½•å¸è½½ï¼Ÿ</summary>
            <div class="faq-content">
              <ul>
                <li>
                  <strong>Windows:</strong> é€šè¿‡"è®¾ç½® > åº”ç”¨"å¸è½½ï¼Œæˆ–è¿è¡Œå¸è½½ç¨‹åº
                </li>
                <li>
                  <strong>macOS:</strong> åˆ é™¤ Applications æ–‡ä»¶å¤¹ä¸­çš„ Hagicode
                  Desktop
                </li>
                <li>
                  <strong>Linux:</strong> ä½¿ç”¨åŒ…ç®¡ç†å™¨å¸è½½æˆ–åˆ é™¤ AppImage æ–‡ä»¶
                </li>
              </ul>
            </div>
          </details>

          <details class="faq-item">
            <summary>æ˜¯å¦éœ€è¦ç½‘ç»œè¿æ¥ï¼Ÿ</summary>
            <div class="faq-content">
              <p>
                ä»…åœ¨ä»¥ä¸‹æƒ…å†µéœ€è¦ç½‘ç»œè¿æ¥ï¼š
              </p>
              <ul>
                <li>é¦–æ¬¡ä¸‹è½½å’Œå®‰è£…åº”ç”¨</li>
                <li>ä½¿ç”¨ AI ç¼–ç åŠ©æ‰‹ï¼ˆå¦‚ Claude Codeã€Copilot ç­‰ï¼‰</li>
                <li>æ£€æŸ¥å’Œä¸‹è½½åº”ç”¨æ›´æ–°</li>
              </ul>
              <p>
                åº”ç”¨æœ¬ä½“å¯ä»¥ç¦»çº¿è¿è¡Œï¼Œä½† AI ç¼–ç åŠ©æ‰‹åŠŸèƒ½éœ€è¦ç½‘ç»œè¿æ¥æ¥è°ƒç”¨ç›¸åº”çš„æœåŠ¡ã€‚
              </p>
            </div>
          </details>

          <details class="faq-item">
            <summary>å¦‚ä½•è·å–å¸®åŠ©ä¸æ”¯æŒï¼Ÿ</summary>
            <div class="faq-content">
              <p>å¦‚æœä½ åœ¨ä½¿ç”¨ Hagicode Desktop æ—¶é‡åˆ°é—®é¢˜æˆ–æœ‰ä»»ä½•å»ºè®®ï¼Œæˆ‘ä»¬æä¾›å¤šç§æ–¹å¼ä¸ä½ è”ç³»ï¼š</p>
              <ul>
                <li>
                  <strong>å®˜æ–¹ç½‘ç«™ï¼š</strong>
                  <a href="https://hagicode.com" target="_blank" rel="noopener noreferrer">https://hagicode.com</a>
                  <br />
                  è®¿é—®æˆ‘ä»¬çš„å®˜ç½‘è·å–æœ€æ–°åŠ¨æ€ã€æ–‡æ¡£å’Œæ•™ç¨‹ã€‚
                </li>
                <li>
                  <strong>GitHub ä»“åº“ï¼š</strong>
                  <a href="https://github.com/HagiCode-org/site" target="_blank" rel="noopener noreferrer">https://github.com/HagiCode-org/site</a>
                  <br />
                  åœ¨ GitHub ä¸Šæäº¤ Issueã€å‚ä¸è®¨è®ºæˆ–æŸ¥çœ‹æºä»£ç ã€‚æ¬¢è¿ç»™æˆ‘ä»¬ä¸€ä¸ª Star â­
                </li>
                <li>
                  <strong>QQ ç¾¤ï¼š</strong>
                  <a href="https://qm.qq.com/q/Fwb0o094kw" target="_blank" rel="noopener noreferrer">æŠ€æœ¯æ”¯æŒç¾¤ 610394020</a>
                  <br />
                  åŠ å…¥æˆ‘ä»¬çš„ QQ ç¾¤ä¸å…¶ä»–ç”¨æˆ·äº¤æµï¼Œè·å–å®æ—¶å¸®åŠ©ã€‚
                </li>
                <li>
                  <strong>é‚®ç®±æ”¯æŒï¼š</strong>
                  <a href="mailto:support@hagicode.com">support@hagicode.com</a>
                  <br />
                  é€šè¿‡é‚®ä»¶è”ç³»æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šåœ¨æ”¶åˆ°é‚®ä»¶åå°½å¿«å›å¤ã€‚
                </li>
              </ul>
              <p>
                æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„åé¦ˆï¼ŒåŒ…æ‹¬åŠŸèƒ½å»ºè®®ã€Bug æŠ¥å‘Šå’Œä½¿ç”¨ä½“éªŒåˆ†äº«ã€‚ä½ çš„æ„è§å¯¹æˆ‘ä»¬éå¸¸é‡è¦ï¼
              </p>
            </div>
          </details>
        </div>
      </section>
    </main>

    <Footer client:load />

    <!-- å¹³å°æ£€æµ‹å’ŒæŒ‰é’®é‡æ’åºè„šæœ¬ + æ¸ é“åˆ‡æ¢è„šæœ¬ -->
    <script type="module">
      (function() {
        function detectOS() {
          // ä¼˜å…ˆæ£€æŸ¥ URL æŸ¥è¯¢å‚æ•°ä¸­çš„ os å‚æ•°ï¼ˆç”¨äºè°ƒè¯•ï¼‰
          const urlParams = new URLSearchParams(window.location.search);
          const osParam = urlParams.get('os');
          if (osParam) {
            const validOS = ['windows', 'macos', 'linux'];
            if (validOS.includes(osParam.toLowerCase())) {
              console.log('[Platform Detection] Using OS from query param:', osParam.toLowerCase());
              return osParam.toLowerCase();
            }
          }

          const userAgent = navigator.userAgent;
          console.log('[Platform Detection] UserAgent:', userAgent);

          if (userAgent.includes('Windows')) {
            console.log('[Platform Detection] Detected: Windows');
            return 'windows';
          }
          if (userAgent.includes('Mac') || userAgent.includes('iPhone') || userAgent.includes('iPad') || userAgent.includes('Mac OS')) {
            console.log('[Platform Detection] Detected: macOS');
            return 'macos';
          }
          if (userAgent.includes('Linux')) {
            console.log('[Platform Detection] Detected: Linux');
            return 'linux';
          }
          console.log('[Platform Detection] Detected: Unknown');
          return 'unknown';
        }

        function highlightCurrentPlatform() {
          const userOS = detectOS();
          const downloadButtons = document.querySelectorAll('.download-option-wrapper');

          console.log('[Platform Detection] Found buttons:', downloadButtons.length);
          console.log('[Platform Detection] User OS:', userOS);

          downloadButtons.forEach(wrapper => {
            const platform = wrapper.dataset.platform;
            console.log('[Platform Detection] Button platform:', platform);

            // ç§»é™¤æ‰€æœ‰æ¨èçŠ¶æ€
            wrapper.classList.remove('download-option-wrapper--recommended');

            // ä¸ºå½“å‰ç”¨æˆ·çš„ç³»ç»Ÿæ·»åŠ æ¨èçŠ¶æ€
            if (platform === userOS) {
              wrapper.classList.add('download-option-wrapper--recommended');
              console.log('[Platform Detection] Added recommended class to:', platform);
            }
          });

          // å¦‚æœæ˜¯æœªçŸ¥ç³»ç»Ÿï¼Œé»˜è®¤æ¨èç¬¬ä¸€ä¸ªå¹³å°ï¼ˆé€šå¸¸æ˜¯ Windowsï¼‰
          if (userOS === 'unknown' && downloadButtons.length > 0) {
            const firstButton = downloadButtons[0];
            firstButton.classList.add('download-option-wrapper--recommended');
            console.log('[Platform Detection] Unknown OS, defaulting to first platform:', firstButton.dataset.platform);
          }

          // é‡æ–°æ’åºï¼šå½“å‰ç³»ç»Ÿæ”¾æœ€å‰é¢
          const buttonsContainer = document.querySelector('.download-buttons');
          if (!buttonsContainer) {
            console.warn('[Platform Detection] Download buttons container not found');
            return;
          }

          const sortedWrappers = Array.from(downloadButtons).sort((a, b) => {
            const aPlatform = a.dataset.platform || '';
            const bPlatform = b.dataset.platform || '';

            // å½“å‰ç³»ç»Ÿçš„å¹³å°æ’æœ€å‰
            if (aPlatform === userOS && bPlatform !== userOS) return -1;
            if (aPlatform !== userOS && bPlatform === userOS) return 1;

            return 0;
          });

          // é‡æ–°æ’åˆ— DOM
          sortedWrappers.forEach(wrapper => {
            buttonsContainer.appendChild(wrapper);
          });
        }

        // ç¡®ä¿åœ¨æ‰€æœ‰å†…å®¹åŠ è½½åæ‰§è¡Œ
        function initPlatformDetection() {
          setTimeout(() => {
            highlightCurrentPlatform();
          }, 100);
        }

        // åœ¨ DOM åŠ è½½åæ‰§è¡Œ
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initPlatformDetection);
        } else {
          initPlatformDetection();
        }
      })();
    </script>
    </script>

    <!-- æ¸ é“åˆ‡æ¢è„šæœ¬ -->
    <script type="module">
      (function() {
        // ä» data å±æ€§ä¸­è¯»å–æ¸ é“ä¿¡æ¯
        var channelDataElement = document.getElementById('channel-data');
        if (!channelDataElement) {
          console.log('[Channel Switch] Channel data element not found');
          return;
        }

        var hasChannels = channelDataElement.dataset.hasChannels === 'true';
        var channelsJSON = channelDataElement.dataset.channels;
        var channelData = channelsJSON ? JSON.parse(channelsJSON) : {};
        console.log('[Channel Switch] Loaded channel data:', channelData);

        if (!hasChannels) {
          console.log('[Channel Switch] Channels not available');
          return;
        }

        // å½“å‰é€‰æ‹©çš„æ¸ é“
        var currentChannel = 'stable';

        // åˆ‡æ¢æ¸ é“
        function switchChannel(channel) {
          console.log('[Channel Switch] Switching to:', channel);
          currentChannel = channel;

          // æ›´æ–°æ¸ é“æ ‡ç­¾é¡µçŠ¶æ€
          document.querySelectorAll('.channel-tab').forEach(function(tab) {
            var tabChannel = tab.dataset.channel;
            if (tabChannel === channel) {
              tab.classList.add('channel-tab--active');
              tab.setAttribute('aria-selected', 'true');
            } else {
              tab.classList.remove('channel-tab--active');
              tab.setAttribute('aria-selected', 'false');
            }
          });

          // æ˜¾ç¤º/éšè— Beta è­¦å‘Š
          var betaWarning = document.getElementById('beta-warning');
          if (betaWarning) {
            betaWarning.style.display = channel === 'beta' ? 'flex' : 'none';
          }

          // æ›´æ–°ä¸‹è½½æŒ‰é’®
          updateDownloadButtons(channel);

          // æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
          updateVersionInfo(channel);
        }

        // æ›´æ–°ä¸‹è½½æŒ‰é’® - æ›´æ–°ç°æœ‰ç»„ä»¶çš„é“¾æ¥å’Œæ•°æ®
        function updateDownloadButtons(channel) {
          var wrappers = document.querySelectorAll('.download-option-wrapper');
          if (!wrappers || wrappers.length === 0) {
            console.warn('[Channel Switch] No download button wrappers found');
            return;
          }

          var channelInfo = channelData[channel];
          if (!channelInfo || !channelInfo.platforms || channelInfo.platforms.length === 0) {
            console.warn('[Channel Switch] No platforms available for channel:', channel);
            return;
          }

          console.log('[Channel Switch] Updating download buttons for channel:', channel, 'with', channelInfo.platforms.length, 'files');

          // æŒ‰å¹³å°åˆ†ç»„æ–‡ä»¶
          var platforms = {
            windows: [],
            macos: [],
            linux: []
          };

          channelInfo.platforms.forEach(function(file) {
            var name = file.name.toLowerCase();
            if (name.includes('.exe') || name.includes('.appx')) {
              platforms.windows.push(file);
            } else if (name.includes('.dmg') || name.includes('-mac.zip')) {
              platforms.macos.push(file);
            } else if (name.includes('.appimage') || name.includes('.deb') || name.includes('.tar.gz')) {
              platforms.linux.push(file);
            }
          });

          // æ›´æ–°æ¯ä¸ªå¹³å°çš„ä¸‹è½½æŒ‰é’®
          wrappers.forEach(function(wrapper) {
            var platform = wrapper.dataset.platform;
            if (!platform || !platforms[platform] || platforms[platform].length === 0) {
              return; // è·³è¿‡æ²¡æœ‰æ–‡ä»¶çš„å¹³å°
            }

            var platformFiles = platforms[platform];

            // è·å–æ¨èæ–‡ä»¶
            var recommendedFile = platformFiles[0];
            if (platform === 'windows') {
              recommendedFile = platformFiles.find(function(f) { return f.name.indexOf('Setup') >= 0; }) || platformFiles[0];
            } else if (platform === 'macos') {
              recommendedFile = platformFiles.find(function(f) { return f.name.indexOf('arm64') >= 0; }) || platformFiles[0];
            } else if (platform === 'linux') {
              recommendedFile = platformFiles.find(function(f) { return f.name.indexOf('.AppImage') >= 0; }) || platformFiles[0];
            }

            // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
            var sizeInMB = (recommendedFile.size / (1024 * 1024)).toFixed(0);
            var size = parseFloat(sizeInMB) >= 1000 ? (parseFloat(sizeInMB) / 1024).toFixed(1) + ' GB' : sizeInMB + ' MB';
            var downloadUrl = 'https://desktop.dl.hagicode.com/' + recommendedFile.path;

            // æ›´æ–°ä¸»ä¸‹è½½æŒ‰é’®
            var mainBtn = wrapper.querySelector('.btn-download-main');
            if (mainBtn) {
              mainBtn.href = downloadUrl;
              mainBtn.setAttribute('download', recommendedFile.name);
            }

            // æ›´æ–°æŒ‰é’®å‰¯æ ‡ç­¾ï¼ˆæ–‡ä»¶åï¼‰
            var sublabel = wrapper.querySelector('.btn-sublabel');
            if (sublabel) {
              sublabel.textContent = recommendedFile.name;
            }

            // æ›´æ–°ä¸‹æ‹‰èœå•é¡¹
            var dropdownMenu = wrapper.querySelector('.dropdown-menu');
            if (dropdownMenu) {
              // æ¸…ç©ºç°æœ‰èœå•é¡¹
              dropdownMenu.innerHTML = '';

              // æ·»åŠ æ–°çš„èœå•é¡¹
              platformFiles.forEach(function(file) {
                var fileSize = (file.size / (1024 * 1024)).toFixed(0);
                var formattedSize = parseFloat(fileSize) >= 1000 ? (parseFloat(fileSize) / 1024).toFixed(1) + ' GB' : fileSize + ' MB';
                var fileUrl = 'https://desktop.dl.hagicode.com/' + file.path;

                var li = document.createElement('li');
                li.setAttribute('role', 'none');

                var a = document.createElement('a');
                a.href = fileUrl;
                a.className = 'dropdown-item';
                a.setAttribute('role', 'option');
                a.setAttribute('target', '_blank');
                a.setAttribute('rel', 'noopener noreferrer');
                a.dataset.label = file.name;
                a.dataset.url = fileUrl;

                a.style.display = 'flex';
                a.style.alignItems = 'center';
                a.style.justifyContent = 'space-between';
                a.style.gap = '0.5rem';
                a.style.padding = '0.75rem 1rem';
                a.style.textDecoration = 'none';
                a.style.borderRadius = '0.375rem';
                a.style.transition = 'all 0.15s ease-out';
                a.style.fontSize = '0.875rem';
                a.style.color = 'var(--color-text-secondary)';

                var labelSpan = document.createElement('span');
                labelSpan.className = 'dropdown-item-label';
                labelSpan.textContent = file.name;
                labelSpan.style.flex = '1';

                var sizeSpan = document.createElement('span');
                sizeSpan.className = 'dropdown-item-size';
                sizeSpan.textContent = formattedSize;
                sizeSpan.style.fontSize = '0.75rem';
                sizeSpan.style.color = 'var(--color-text-muted)';

                a.appendChild(labelSpan);
                a.appendChild(sizeSpan);
                li.appendChild(a);
                dropdownMenu.appendChild(li);

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                a.addEventListener('click', function(e) {
                  e.preventDefault();

                  // æ›´æ–°ä¸»æŒ‰é’®
                  var sublabel = wrapper.querySelector('.btn-sublabel');
                  var mainLink = wrapper.querySelector('.btn-download-main');

                  if (sublabel && mainLink) {
                    sublabel.textContent = file.name;
                    mainLink.href = fileUrl;
                    mainLink.setAttribute('download', file.name);
                  }

                  // å…³é—­ä¸‹æ‹‰èœå•
                  var toggle = wrapper.querySelector('.btn-dropdown-toggle');
                  if (toggle) {
                    toggle.setAttribute('aria-expanded', 'false');
                  }
                });

                // æ·»åŠ æ‚¬åœæ•ˆæœ
                a.addEventListener('mouseenter', function() {
                  a.style.background = 'var(--color-surface-hover)';
                  a.style.color = 'var(--color-text)';
                });

                a.addEventListener('mouseleave', function() {
                  a.style.background = '';
                  a.style.color = 'var(--color-text-secondary)';
                });
              });
            }
          });

          // é‡æ–°ç»‘å®šå¹³å°æ£€æµ‹
          setTimeout(function() {
            if (typeof highlightCurrentPlatform === 'function') {
              highlightCurrentPlatform();
            }
          }, 50);
        }

        // æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
        function updateVersionInfo(channel) {
          var versionInfoEl = document.querySelector('.version-info');
          if (!versionInfoEl) return;

          var channelInfo = channelData[channel];
          if (channelInfo && channelInfo.latest) {
            var betaTag = channel === 'beta' ? ' <span class="beta-tag">[æµ‹è¯•ç‰ˆ]</span>' : '';
            versionInfoEl.innerHTML = 'æœ€æ–°ç‰ˆæœ¬: ' + channelInfo.latest + betaTag;
          }
        }

        // åˆå§‹åŒ–æ¸ é“åˆ‡æ¢
        function initChannelSwitch() {
          var channelTabs = document.querySelectorAll('.channel-tab');
          console.log('[Channel Switch] Found tabs:', channelTabs.length);

          channelTabs.forEach(function(tab) {
            tab.addEventListener('click', function(e) {
              e.preventDefault();
              var channel = tab.dataset.channel;
              console.log('[Channel Switch] Tab clicked:', channel);
              switchChannel(channel);
            });
          });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initChannelSwitch);
        } else {
          initChannelSwitch();
        }

        console.log('[Channel Switch] Initialized successfully');
      })();
    </script>

    <!-- Microsoft Clarity åˆ†æ -->
    <Clarity />
  </body>
</html>
