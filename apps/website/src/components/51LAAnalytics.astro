---
/**
 * 51LA Analytics 用户行为分析集成组件
 * 仅在生产环境加载 51LA 脚本
 *
 * @see https://www.51.la/
 */
// Astro 组件在服务端执行时可以直接访问 process.env
// 对于构建时静态生成，process.env 在构建时可用
// 默认使用硬编码的 ID，环境变量可覆盖
const default51LAId = 'L6b88a5yK4h2Xnci';
const laId = import.meta.env.VITE_51LA_ID || default51LAId;
const isProduction = import.meta.env.PROD;

// 在构建时检查是否应该加载 51LA Analytics
// 仅在生产环境加载（使用默认 ID 或环境变量提供的 ID）
const shouldLoad51LA = isProduction;

// 可选的构建时调试日志
if (import.meta.env.VITE_51LA_DEBUG) {
  console.log('[51LA Analytics] Build-time state:', {
    isProduction,
    laId: laId ? '***' + laId.slice(-4) : 'not set',
    shouldLoad51LA: !!shouldLoad51LA,
    NODE_ENV: process.env.NODE_ENV,
  });
}
---

{shouldLoad51LA && (
  <>
    <script is:inline charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
    <script is:inline define:vars={{laId}}>
      LA.init({id:laId,ck:laId,autoTrack:true,hashMode:true,screenRecord:true})
    </script>
  </>
)}
