# Proposal: 自定义 404 错误页面

## 元数据

- **变更 ID**: `custom-404-error-page-arg-value`
- **创建日期**: 2026-01-30
- **状态**: 已完成
- **影响范围**: Astro 站点页面路由
- **优先级**: 中等
- **复杂度**: 低

## 概述

创建自定义的 404 错误页面 (`src/pages/404.astro`),为访问不存在 URL 的用户提供友好的错误提示和有效的导航引导,提升用户体验并降低跳出率。

## 背景

### 当前问题

Hagicode 文档站点当前使用 Astro 框架的默认 404 页面,该页面存在以下问题:

1. **用户体验差**: 用户访问错误的 URL 时,无法获得有效的导航帮助
2. **缺乏引导性**: 没有指向关键页面的链接,用户可能不知道从哪里开始
3. **品牌不一致**: 默认 404 页面与站点的视觉风格和品牌形象不匹配
4. **用户流失**: 访问错误链接的用户可能直接离开站点,而不是被引导到相关内容

### 站点核心内容

站点的关键页面包括:

- **首页** (`/`): 项目概览和产品特性展示
- **安装指南** (`/docs/installation/docker-compose` 或 `/docs/installation/package-deployment`): 指导用户如何安装 Hagicode
- **快速开始** (`/docs/quick-start/`): 包含创建会话、项目等入门指南
- **产品概览** (`/docs/product-overview.md`): 了解 Hagicode 的核心功能和特性

## 解决方案

### 实施内容

创建自定义的 404 页面 (`src/pages/404.astro`),提供以下功能:

1. **友好的错误提示**: 使用清晰的中文说明页面未找到
2. **引导性导航链接**: 提供以下关键页面的快捷入口:
   - **首页** (/): 返回站点主页,了解 Hagicode 产品概览
   - **安装指南** (`/docs/installation/docker-compose` 或 `/docs/installation/package-deployment`): 指导用户如何安装 Hagicode
   - **使用指南** (`/docs/quick-start/`): 包含创建会话、项目等快速开始教程
   - **产品概览** (`/docs/product-overview.md`): 了解 Hagicode 的核心功能和特性
3. **视觉一致性**: 使用站点的 CSS 变量和主题系统,保持与首页、文档页面的布局风格一致
4. **响应式设计**: 确保在不同设备上都能正常显示

### 技术实现

- **文件位置**: `src/pages/404.astro`
- **组件集成**:
  - 导入 `Navbar` 组件提供完整的导航功能
  - 使用 `withBasePath` 工具函数处理链接路径
  - 应用站点 CSS 变量和主题系统
- **样式**: 使用内联样式或独立 CSS 模块,遵循站点设计系统
- **元数据**: 包含适当的标题和描述

## 影响范围

### 受影响的组件和文件

1. **新增文件**:
   - `src/pages/404.astro` - 自定义 404 页面

2. **现有文件**:
   - 无修改(仅新增文件)

### 影响的功能

- **404 错误处理**: 当用户访问不存在的 URL 时,显示自定义页面而不是 Astro 默认页面
- **站点导航**: 404 页面上的导航链接必须正确工作

## 收益

实施此变更将带来以下改进:

1. **提升用户体验**: 用户在访问错误页面时能够快速找到需要的内容
2. **降低跳出率**: 通过提供有效的导航选项,减少用户因 404 错误而离开站点的可能性
3. **增强品牌形象**: 自定义 404 页面展示了对用户体验的关注,提升专业度
4. **符合 OpenSpec 规范**: 遵循项目的组件开发约定和文档结构
5. **无破坏性更改**: 仅新增 `404.astro` 文件,不影响现有页面和路由

## 风险和缓解措施

### 风险

1. **样式不一致**: 新页面可能与现有页面视觉风格不匹配
2. **链接失效**: 在不同部署场景下(base path 配置)链接可能失效

### 缓解措施

1. **样式一致性**:
   - 使用站点现有的 CSS 变量和主题系统
   - 参考 `index.astro` 和文档页面的布局结构
   - 集成 `Navbar` 组件确保导航体验一致

2. **链接有效性**:
   - 使用 `withBasePath` 工具函数处理所有内部链接
   - 在根路径和子路径部署场景下进行测试
   - 确保链接在生产和预览环境中都正常工作

## 测试计划

### 功能测试

1. **404 页面渲染**:
   - 访问不存在的 URL,确保显示自定义 404 页面
   - 验证页面显示友好的中文错误提示
   - 确认所有导航链接都显示正确

2. **导航测试**:
   - 点击所有导航链接,确保跳转到正确的页面
   - 在根路径部署模式下测试链接
   - 在子路径部署模式下测试链接(如果使用 `VITE_SITE_BASE`)

3. **响应式设计测试**:
   - 在移动设备(width < 768px)上测试页面布局
   - 在平板设备(768px - 1024px)上测试页面布局
   - 在桌面设备(> 1024px)上测试页面布局

### 主题切换测试

1. **浅色主题**:
   - 验证 404 页面在浅色主题下显示正常
   - 确保文本对比度符合 WCAG AA 标准

2. **深色主题**:
   - 验证 404 页面在深色主题下显示正常
   - 确保文本对比度符合 WCAG AA 标准

3. **主题切换**:
   - 在 404 页面上切换主题,确保主题切换正常工作

### 构建和类型检查

1. **构建验证**:
   - 运行 `npm run build`,确保构建成功
   - 验证 `dist/404.html` 文件正确生成

2. **类型检查**:
   - 运行 `npm run typecheck`,确保无类型错误

## 依赖和约束

### 依赖

- `src/components/home/Navbar.tsx` - 导航栏组件(可选集成)
- `src/utils/path.ts` - 路径工具函数,用于处理 base path

### 约束

- 必须遵循项目的 TypeScript 严格模式配置
- 必须遵循站点的 CSS 变量设计系统
- 必须支持站点的主题切换功能(浅色/深色主题)
- 必须在不同 base path 配置下正常工作
- 必须通过 `npm run build` 验证

## 实施计划

详细的实施步骤请参见 `tasks.md`。

## 验收标准

变更被视为完成当且仅当:

1. ✅ `src/pages/404.astro` 文件已创建
2. ✅ 访问不存在的 URL 时显示自定义 404 页面
3. ✅ 页面包含友好的中文错误提示
4. ✅ 页面提供以下导航链接:
   - 首页
   - 安装指南
   - 快速开始
   - 产品概览
5. ✅ 所有链接在根路径和子路径部署场景下都正常工作
6. ✅ 页面在浅色和深色主题下都正常显示
7. ✅ 页面在移动设备、平板和桌面设备上响应式显示
8. ✅ `npm run build` 成功完成
9. ✅ `npm run typecheck` 无类型错误
10. ✅ TypeScript 严格模式检查通过

## 相关规范

- `openspec/specs/astro-site/spec.md` - Astro 站点功能规范

## 参考资料

- Astro 404 页面文档: https://docs.astro.build/en/guides/routing/#404-pages
- 站点设计系统: `src/styles/global.css`
- 路径工具函数: `src/utils/path.ts`
