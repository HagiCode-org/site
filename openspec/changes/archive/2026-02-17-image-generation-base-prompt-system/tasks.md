# Implementation Tasks: 图片生成基底提示词系统

## 1. 配置文件创建

- [ ] 1.1 创建 `scripts/image-base-prompt.json` 配置文件
  - [ ] 定义 `basePrompt` 字段包含统一视觉风格描述
  - [ ] 定义 `defaultEnabled` 字段控制默认启用状态
  - [ ] 定义 `contexts` 对象包含不同上下文的提示词增强
  - [ ] 添加颜色调板、字体、设计风格等视觉规范

- [ ] 1.2 编写配置文件文档注释
  - [ ] 说明每个字段的用途
  - [ ] 提供配置示例

## 2. 脚本功能增强

- [ ] 2.1 添加新命令行参数到 `generate-image.sh`
  - [ ] 实现 `--use-base-prompt` 参数（默认启用）
  - [ ] 实现 `--no-base-prompt` 参数禁用基底提示词
  - [ ] 实现 `--context <type>` 参数选择上下文类型
  - [ ] 实现 `--custom-prompt <text>` 参数添加自定义提示词
  - [ ] 更新 `show_help()` 函数显示新参数说明

- [ ] 2.2 实现配置文件读取功能
  - [ ] 创建 `load_base_prompt_config()` 函数
  - [ ] 验证配置文件存在性和格式正确性
  - [ ] 处理配置文件缺失的优雅降级
  - [ ] 添加配置文件路径解析逻辑

- [ ] 2.3 实现提示词组合逻辑
  - [ ] 创建 `build_final_prompt()` 函数
  - [ ] 按优先级组合：基底提示词 + 上下文提示词 + 用户提示词
  - [ ] 实现上下文类型验证
  - [ ] 处理提示词长度限制（不超过 4000 字符）
  - [ ] 添加 verbose 日志输出提示词组合过程

- [ ] 2.4 更新参数验证逻辑
  - [ ] 扩展 `validate_parameters()` 函数
  - [ ] 添加上下文类型验证（必须在配置文件中定义）
  - [ ] 添加自定义提示词长度验证

- [ ] 2.5 更新主函数逻辑
  - [ ] 在参数解析后加载配置文件
  - [ ] 在 API 调用前组合最终提示词
  - [ ] 保持向后兼容性（无新参数时原有行为不变）

## 3. npm 脚本集成

- [ ] 3.1 添加图片生成便捷命令到 `package.json`
  - [ ] `generate:image` - 使用默认配置生成图片
  - [ ] `generate:image:custom` - 允许传递自定义参数
  - [ ] 确保脚本在 monorepo 架构下正确工作

- [ ] 3.2 更新脚本帮助文档
  - [ ] 在 README 或文档中添加使用示例
  - [ ] 说明参数组合规则

## 4. 测试验证

- [ ] 4.1 本地功能测试
  - [ ] 测试仅使用基底提示词
  - [ ] 测试基底提示词 + 上下文提示词
  - [ ] 测试基底提示词 + 自定义提示词
  - [ ] 测试完整组合：基底 + 上下文 + 自定义
  - [ ] 测试 `--no-base-prompt` 禁用基底提示词
  - [ ] 测试配置文件缺失的降级行为
  - [ ] 测试无效上下文类型的错误处理

- [ ] 4.2 参数验证测试
  - [ ] 测试提示词长度超限的错误处理
  - [ ] 测试必需参数缺失的错误处理
  - [ ] 测试无效参数值的错误处理

- [ ] 4.3 输出质量验证
  - [ ] 验证生成的图片符合视觉规范
  - [ ] 验证不同上下文类型的视觉差异
  - [ ] 确认品牌色彩和风格的一致性

## 5. 文档更新

- [ ] 5.1 更新脚本使用文档
  - [ ] 添加新参数说明
  - [ ] 提供使用示例
  - [ ] 说明配置文件格式

- [ ] 5.2 更新 OpenSpec 规格
  - [ ] 归档此变更提案
  - [ ] 更新 `specs/build-scripts/spec.md`

## 6. 代码审查与发布

- [ ] 6.1 代码审查
  - [ ] 确保代码符合项目规范
  - [ ] 验证向后兼容性
  - [ ] 检查错误处理完整性

- [ ] 6.2 创建 Pull Request
  - [ ] 提交代码变更
  - [ ] 链接到此 OpenSpec 提案
  - [ ] 通过 CI/CD 验证

- [ ] 6.3 部署验证
  - [ ] 确认部署成功
  - [ ] 验证生产环境功能正常

## 完成标准

- 所有图片生成使用统一的基底提示词
- 支持上下文特定的视觉增强
- 提供灵活的自定义选项
- 向后兼容现有使用方式
- 文档完整，示例清晰
- 通过所有测试验证
