# 迁移任务清单

## 1. 准备阶段

- [ ] 1.1 分析当前图片引用情况
  - [ ] 1.1.1 扫描所有包含图片引用的 Markdown 文件
  - [ ] 1.1.2 统计需要迁移的图片数量和分布
  - [ ] 1.1.3 识别高频访问页面（优先迁移）

- [ ] 1.2 验证产品概述页面的实现
  - [ ] 1.2.1 分析 `product-overview.md` 的图片引用方式
  - [ ] 1.2.2 确认 `src/content/docs/img/` 目录结构
  - [ ] 1.2.3 验证构建配置是否已支持相对路径

- [ ] 1.3 创建迁移脚本
  - [ ] 1.3.1 编写图片路径扫描脚本
  - [ ] 1.3.2 编写图片文件迁移脚本
  - [ ] 1.3.3 编写 Markdown 路径替换脚本
  - [ ] 1.3.4 编写验证脚本检查链接有效性

## 2. 内容迁移

- [ ] 2.1 迁移快速开始文档的图片
  - [ ] 2.1.1 迁移 `quick-start/conversation-session.md` 的图片
  - [ ] 2.1.2 迁移 `quick-start/proposal-session.md` 的图片
  - [ ] 2.1.3 迁移 `quick-start/create-first-project.md` 的图片

- [ ] 2.2 迁移安装指南文档的图片
  - [ ] 2.2.1 迁移 `installation/` 目录下的所有图片引用
  - [ ] 2.2.2 更新相关 Markdown 文件的路径引用

- [ ] 2.3 迁移相关软件安装文档的图片
  - [ ] 2.3.1 迁移 `related-software-installation/` 目录下的所有图片引用
  - [ ] 2.3.2 更新相关 Markdown 文件的路径引用

- [ ] 2.4 迁移博客文章的图片（如有）
  - [ ] 2.4.1 扫描 `blog/` 目录下的图片引用
  - [ ] 2.4.2 迁移博客图片到 `src/content/docs/blog/img/`

## 3. 构建配置调整

- [ ] 3.1 验证 Astro 配置
  - [ ] 3.1.1 检查 `astro.config.mjs` 是否需要更新
  - [ ] 3.1.2 验证 Content Collections 配置正确性
  - [ ] 3.1.3 确认静态资源处理逻辑

- [ ] 3.2 配置图片优化（可选）
  - [ ] 3.2.1 验证 sharp 图片优化集成
  - [ ] 3.2.2 配置图片压缩和格式转换选项
  - [ ] 3.2.3 测试响应式图片生成

## 4. 文档更新

- [ ] 4.1 更新贡献指南
  - [ ] 4.1.1 添加图片引用规范说明
  - [ ] 4.1.2 提供正确和错误示例
  - [ ] 4.1.3 说明相对路径的使用方法

- [ ] 4.2 更新模板文件
  - [ ] 4.2.1 确保新文档模板使用正确的图片引用方式
  - [ ] 4.2.2 更新文档创建说明

## 5. 测试与验证

- [ ] 5.1 本地测试
  - [ ] 5.1.1 运行 `npm run dev` 验证开发环境
  - [ ] 5.1.2 运行 `npm run build` 验证构建成功
  - [ ] 5.1.3 运行 `npm run typecheck` 验证类型检查
  - [ ] 5.1.4 手动检查页面图片加载正常

- [ ] 5.2 链接验证
  - [ ] 5.2.1 运行自动化链接检查脚本
  - [ ] 5.2.2 修复所有断开的图片链接
  - [ ] 5.2.3 验证旧路径重定向（如保留）

- [ ] 5.3 OpenSpec 验证
  - [ ] 5.3.1 运行 `openspec validate astro-image-migration --strict`
  - [ ] 5.3.2 修复所有验证错误

## 6. 部署与监控

- [ ] 6.1 准备部署
  - [ ] 6.1.1 创建 feature 分支进行迁移
  - [ ] 6.1.2 提交所有变更
  - [ ] 6.1.3 创建 Pull Request

- [ ] 6.2 部署后验证
  - [ ] 6.2.1 等待 CI/CD 构建完成
  - [ ] 6.2.2 验证生产环境图片加载正常
  - [ ] 6.2.3 检查浏览器控制台无 404 错误

- [ ] 6.3 清理工作
  - [ ] 6.3.1 归档此变更提案
  - [ ] 6.3.2 更新项目文档
  - [ ] 6.3.3 考虑是否删除 `public/img/` 中的已迁移图片

## 进度跟踪

- **总任务数**: 38
- **已完成**: 0
- **进行中**: 0
- **待完成**: 38

## 注意事项

1. **渐进式迁移**：不需要一次性完成所有迁移，可以分批次进行
2. **保持兼容**：迁移期间保持新旧方式共存，避免破坏现有功能
3. **充分测试**：每次迁移后都要验证构建和页面加载正常
4. **备份重要**：迁移前备份 `public/img/` 目录，以防需要回滚
