# Proposal: 为 Astro 文档站点添加侧边栏导航

## 概述

为 Hagicode 文档站点添加**左侧边栏导航组件**,提升用户在浏览文档时的导航体验和上下文感知能力。

## 问题陈述

当前文档站点存在以下用户体验问题:

1. **导航不便** - 用户无法快速查看文档的目录结构和层级关系
2. **缺少上下文** - 用户无法直观了解当前文档在整体文档体系中的位置
3. **跳转效率低** - 在相关文档之间导航需要返回上级页面或通过面包屑导航,操作路径较长
4. **不符合文档站最佳实践** - 主流文档站点(Docusaurus、GitBook、VitePress 等)均提供侧边栏导航

## 建议的解决方案

在文档页面添加**左侧边栏导航组件**,实现以下功能:

### 核心功能

1. **目录树结构展示**
   - 基于 Astro Content Collections 自动生成文档目录树
   - 支持多级目录嵌套显示
   - 使用图标区分目录和文档

2. **当前位置高亮**
   - 自动识别当前浏览的文档页面
   - 高亮显示当前文档在侧边栏中的位置
   - 自动展开当前文档所属的父级目录

3. **交互行为**
   - 点击目录项可跳转到对应文档
   - 支持目录展开/折叠(默认展开当前文档相关路径)
   - 移动端响应式设计(小屏幕下可收起/展开侧边栏)

4. **布局调整**
   - 左侧:侧边栏(固定宽度 280px,可配置)
   - 右侧:主内容区域
   - 使用 CSS Grid 实现响应式布局
   - 移动端下侧边栏默认隐藏,通过汉堡菜单触发显示

### 技术实现

- **新增组件**: `src/components/Sidebar.astro`
- **修改布局**: `src/layouts/DocsLayout.astro`
- **数据源**: 使用 `getCollection('docs')` 获取文档结构
- **样式**: 扩展 `src/styles/global.css` 添加侧边栏相关样式
- **主题适配**: 使用 CSS 变量确保亮色/暗色模式兼容
- **路径兼容**: 确保 `VITE_SITE_BASE` 环境变量正常工作

## 范围

### 包含的内容

- 创建独立的侧边栏导航组件
- 修改文档页面布局以容纳侧边栏
- 实现文档树形结构的自动生成
- 实现当前页面高亮和路径自动展开
- 实现响应式布局和移动端适配
- 主题系统适配(亮色/暗色模式)

### 不包含的内容

- 修改现有文档内容和 frontmatter
- 添加文档排序功能(如需排序,使用现有的 `sidebar_position` 字段)
- 添加搜索功能(作为单独提案)
- 添加面包屑导航(作为单独提案)
- 多语言支持(站点当前为单语言站点)

## 影响评估

### 用户体验改进

- **更快的导航速度** - 用户可直接从侧边栏跳转到任意文档
- **更好的上下文感知** - 清晰展示文档层级关系和当前位置
- **更符合用户习惯** - 与主流文档站交互模式一致

### 技术影响

- 新增组件文件 `src/components/Sidebar.astro`
- 修改布局文件 `src/layouts/DocsLayout.astro`
- 新增样式到 `src/styles/global.css`
- 无需修改现有文档内容和路由结构
- 与现有的目录路由功能完全兼容

### 兼容性

- 与现有主题系统完全兼容
- 支持可配置的站点基础路径(`VITE_SITE_BASE`)
- 响应式设计确保在所有设备上正常显示
- 构建时静态生成,无运行时性能开销

## 替代方案

### 方案 1: 使用第三方 Astro 组件库

**优点**:
- 开箱即用,开发速度快
- 社区维护,可能有更好的功能

**缺点**:
- 引入额外依赖
- 可能不完全符合项目定制需求
- 未来维护受限于第三方库的更新节奏

**决策**: **不采用**。当前需求相对明确且简单,自己实现可以更好地控制功能和样式,避免引入不必要的依赖。

### 方案 2: 使用 Astro 集成(如 @astrojs/sidebar)

**优点**:
- 官方或社区集成,与 Astro 深度集成
- 可能有更好的性能优化

**缺点**:
- 目前没有成熟的官方侧边栏集成
- 社区集成可能不够稳定
- 定制化程度可能不如自己实现

**决策**: **不采用**。考虑到项目已经迁移到 Astro 并有特定的设计需求,自己实现更灵活。

### 方案 3: 仅添加目录页面链接(不实现完整侧边栏)

**优点**:
- 实现简单,改动最小
- 不影响现有布局

**缺点**:
- 用户体验提升有限
- 仍无法解决导航不便的问题
- 不符合文档站最佳实践

**决策**: **不采用**。无法从根本上解决用户体验问题。

## 成功标准

### 功能性指标

- ✅ 所有文档页面左侧显示侧边栏导航
- ✅ 侧边栏正确显示文档目录树结构
- ✅ 当前页面在侧边栏中高亮显示
- ✅ 当前页面所属目录自动展开
- ✅ 点击侧边栏链接可正确跳转
- ✅ 移动端侧边栏可正常收起/展开
- ✅ 亮色/暗色主题下样式正常

### 性能指标

- ✅ 构建时间增加 < 10%
- ✅ 构建后的页面体积增加 < 20KB
- ✅ 侧边栏交互响应时间 < 100ms
- ✅ Lighthouse 性能分数保持 > 90

### 兼容性指标

- ✅ 支持所有主流现代浏览器(Chrome, Firefox, Safari, Edge)
- ✅ 移动端浏览器正常显示和交互
- ✅ 与现有的 `VITE_SITE_BASE` 配置兼容
- ✅ 与现有的目录路由功能兼容

## 风险和缓解措施

### 风险 1: 移动端布局复杂度增加

**影响**: 中等
**可能性**: 高

**缓解措施**:
- 优先实现桌面端布局
- 使用现有的响应式断点
- 参考主流文档站的移动端交互模式
- 充分测试不同屏幕尺寸

### 风险 2: 主题系统适配问题

**影响**: 低
**可能性**: 中等

**缓解措施**:
- 使用现有的 CSS 变量系统
- 复用 `src/styles/global.css` 中定义的主题变量
- 在亮色和暗色主题下充分测试

### 风险 3: 构建性能影响

**影响**: 低
**可能性**: 低

**缓解措施**:
- 使用 Astro 的静态生成特性
- 在构建时生成侧边栏数据,而非运行时
- 避免使用客户端 JavaScript 进行数据处理

### 风险 4: 与现有目录路由冲突

**影响**: 中等
**可能性**: 低

**缓解措施**:
- 充分理解现有的 `[...slug].astro` 路由逻辑
- 确保侧边栏不影响现有的目录索引页面
- 在多种路由场景下测试

## 后续工作

本提案实现后,可以考虑以下增强功能:

1. **面包屑导航** - 在页面顶部添加层级导航
2. **搜索功能** - 在侧边栏顶部添加搜索框
3. **文档排序** - 根据 `sidebar_position` 字段或 frontmatter 自定义排序
4. **侧边栏宽度可调节** - 允许用户拖拽调整侧边栏宽度
5. **"下一页/上一页"导航** - 在文档底部添加导航链接

## 时间线估算

- **设计验证**: 0.5 天
- **Sidebar 组件开发**: 1 天
- **布局调整和样式**: 0.5 天
- **响应式和移动端适配**: 0.5 天
- **测试和优化**: 0.5 天
- **总计**: 约 3 天

## 参考资料

- Astro Content Collections 文档: https://docs.astro.build/en/guides/content-collections/
- Astro Routing 文档: https://docs.astro.build/en/core-concepts/routing/
- 现有文档站点结构: `src/content/docs/`
- 现有布局文件: `src/layouts/DocsLayout.astro`
- Docusaurus 侧边栏参考(原站点): `openspec/specs/docusaurus-site/spec.md`
