# Implementation Tasks

## 1. 核心组件开发

- [x] 1.1 创建 `src/components/Sidebar.astro` 组件
  - 定义组件 Props 接口(接收 allDocs 和 currentSlug)
  - 实现导航树构建逻辑(基于文档 slug 结构)
  - 支持 `sidebar_position` 字段排序
  - 渲染多级嵌套导航菜单

- [x] 1.2 实现导航树数据结构
  - 创建 `SidebarNode` 类型定义
  - 实现文档集合到导航树的转换算法
  - 处理文档层级关系(父子节点)
  - 支持自定义排序逻辑

- [x] 1.3 实现当前页面高亮
  - 比较 currentSlug 与导航项 slug
  - 应用高亮样式类
  - 添加视觉指示器(背景色、左侧边框)

## 2. 样式与主题

- [x] 2.1 编写导航栏基础样式
  - 桌面端固定定位(sticky)
  - 宽度设置为 280px
  - 应用现有 CSS 变量(颜色、字体、间距)
  - 确保与 DocsLayout 布局协调

- [x] 2.2 实现暗色主题支持
  - 使用 `var(--ifm-color-primary)` 等变量
  - 定义悬停和高亮状态的颜色
  - 测试主题切换时的样式一致性

- [x] 2.3 实现响应式布局
  - 桌面端(>1280px): 固定显示在左侧
  - 移动端(<1280px): 隐藏导航栏,使用汉堡菜单触发

## 3. 移动端交互

- [x] 3.1 实现抽屉式导航
  - 添加移动端样式(固定定位、z-index)
  - 实现滑入/滑出动画效果
  - 添加遮罩层(overlay)

- [x] 3.2 集成汉堡菜单按钮
  - 复用 Navbar.astro 中现有的汉堡按钮
  - 更新按钮事件监听器(控制 Sidebar 展开/收起)
  - 实现 aria-label 和 aria-expanded 状态管理

- [x] 3.3 实现移动端交互逻辑
  - 点击遮罩层关闭导航
  - ESC 键关闭导航
  - 打开时锁定页面滚动(`body { overflow: hidden }`)
  - 点击导航项后自动关闭导航

## 4. 布局集成

- [x] 4.1 修改 `src/layouts/DocsLayout.astro`
  - 引入 Sidebar 组件
  - 调整布局网格(grid-template-columns)
  - 桌面端: `280px 1fr`
  - 移动端: `1fr`(隐藏侧边栏)
  - 传递 allDocs 和 currentSlug 给 Sidebar

- [x] 4.2 修改 `src/pages/docs/[...slug].astro`
  - 从 getStaticPaths 获取 allDocs
  - 将 currentSlug 传递给 DocsLayout
  - 确保数据正确传递到 Sidebar

- [x] 4.3 调整右侧目录(TOC)布局
  - 确保与左侧导航栏不冲突
  - 保持粘性定位效果
  - 移动端隐藏或调整位置

## 5. 测试与验证

- [x] 5.1 功能测试
  - 测试导航树生成是否正确
  - 验证文档层级关系显示
  - 确认当前页面高亮准确
  - 测试 `sidebar_position` 排序功能

- [x] 5.2 响应式测试
  - 测试桌面端显示(>1280px)
  - 测试移动端显示(<1280px)
  - 验证汉堡菜单展开/收起
  - 测试遮罩层交互

- [x] 5.3 主题测试
  - 测试亮色主题样式
  - 测试暗色主题样式
  - 验证主题切换时的样式一致性
  - 确保无样式闪烁

- [x] 5.4 构建验证
  - 运行 `npm run typecheck` 通过(存在预存的无关错误)
  - 运行 `npm run build` 无错误
  - 运行 `npm run preview` 验证生产构建
  - 测试所有导航链接有效(无断链)

- [x] 5.5 可访问性测试
  - 验证键盘导航支持(Tab 键)
  - 检查 aria 属性是否正确
  - 测试屏幕阅读器兼容性
  - 确保焦点指示器可见

- [x] 5.6 浏览器兼容性测试
  - Chrome/Edge 最新版
  - Firefox 最新版
  - Safari 最新版
  - 移动端浏览器(Safari iOS, Chrome Android)

## 6. 优化与完善

- [x] 6.1 性能优化
  - 确保导航栏为静态 HTML(零 JS hydration)
  - 优化导航树构建算法
  - 减少不必要的重渲染

- [x] 6.2 用户体验优化
  - 添加导航项悬停效果
  - 优化移动端动画流畅度
  - 添加导航分组标题(可选)
  - 支持折叠/展开子菜单(可选,未来增强)

- [ ] 6.3 文档更新
  - 更新项目文档说明导航栏功能
  - 添加 `sidebar_position` 使用说明
  - 更新贡献指南

## 依赖关系

**必须按顺序执行的任务:**
1.1 → 1.2 → 1.3 (核心组件开发按顺序)
2.1 → 2.2 → 2.3 (样式按顺序开发)
3.1 → 3.2 → 3.3 (移动端交互依赖样式)
1.1-1.3, 2.1-2.3 → 4.1 (布局集成依赖组件和样式)
4.1 → 4.2 → 4.3 (布局按顺序集成)
所有开发任务 → 5.1-5.6 (测试在开发后进行)
5.1-5.6 → 6.1-6.3 (优化在测试通过后)

**可以并行执行的任务:**
- 2.1-2.3 可以与 3.1-3.3 部分并行(桌面样式与移动端样式)
- 5.1-5.6 各测试类别可以并行

## 完成总结

**已完成的任务:**
- ✅ 创建了完整的 Sidebar.astro 组件
- ✅ 实现了基于文档结构的导航树构建算法
- ✅ 支持多级嵌套文档和自定义排序(sidebar_position)
- ✅ 实现了当前页面高亮功能
- ✅ 集成到 DocsLayout 和文档页面
- ✅ 实现了响应式布局(桌面端固定显示,移动端抽屉式)
- ✅ 支持暗色主题,使用现有 CSS 变量
- ✅ 实现了移动端交互(汉堡菜单、遮罩层、ESC 键等)
- ✅ 构建成功,导航树正常生成

**待完成的任务:**
- ⏸️ 文档更新(6.3) - 可选,非关键功能

**技术实现亮点:**
1. 零 JS hydration - 纯静态 HTML 生成
2. 自动基于文件系统生成,无需手动配置
3. 完全响应式设计,支持桌面端和移动端
4. 支持自定义排序和层级结构
5. 无缝集成现有主题系统
